---
title: "p5.jsã§ã‚ªãƒªã‚¸ãƒŠãƒ«ãƒ•ã‚©ãƒ³ãƒˆã‚’æ–‡å­—èªè­˜ï¼†ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹"
---

ã“ã®Chapterã§ã¯ã€å¾—ã‚‰ã‚ŒãŸå­¦ç¿’æ¸ˆãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦æ–‡å­—èªè­˜ãŒã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã‚’ä½œæˆã—ãŸã„ã€‚ãƒ„ãƒ¼ãƒ«ã¯ã©ã‚“ãªç’°å¢ƒã§ã‚‚ã‚ˆã„ã®ã ãŒã€åˆå­¦è€…ã«ã‚‚ä½¿ã„ã‚„ã™ã„`p5.js`ã‚’ä½¿ã£ã¦ãƒ„ãƒ¼ãƒ«ã‚’ä½œã£ã¦ã„ãã“ã¨ã«ã™ã‚‹ã€‚

æœ€çµ‚çš„ãªæˆæœç‰©ã¨ã—ã¦ã¯ã€ä»¥ä¸‹ã«ã‚ã‚‹ã‚ˆã†ãª`index.html`, `mySketch.js`ãŒã§ãã‚ãŒã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã€‚
https://github.com/tetunori/ztmy-font-decoder/tree/main
ãªãŠã€[GitHub Pagesã«ãŠè©¦ã—ã§ãã‚‹ç’°å¢ƒ](tetunori.github.io/ztmy-font-decoder/)ã‚’ç”¨æ„ã—ã¦ã„ã‚‹ã€‚

# ãƒ„ãƒ¼ãƒ«ã®æ©Ÿèƒ½æ¦‚è¦(ä½¿ã„æ–¹)
## ã‚«ãƒ¡ãƒ©ã‚’ä½¿ã£ã¦è§£æã™ã‚‹å ´åˆ
1. [ztmy-font-decoder](https://tetunori.github.io/ztmy-font-decoder/)ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã€‚
2. ç”»é¢ä¸ŠåŠåˆ†ã®ğŸ“·ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã€‚
3. è§£æã—ãŸã„éƒ¨åˆ†ã‚’ã‚¿ãƒƒãƒã§é¸æŠã™ã‚‹ã¨ã€ç”»é¢ä¸‹åŠåˆ†ã«è§£æçµæœãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€‚

## ç”»åƒã‹ã‚‰è§£æã™ã‚‹å ´åˆ
1. [ztmy-font-decoder](https://tetunori.github.io/ztmy-font-decoder/)ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã€‚
2. ç”»é¢ä¸‹åŠåˆ†ã®ğŸ“ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã€è§£æã™ã‚‹ç”»åƒã‚’é¸æŠã™ã‚‹ã€‚
3. è§£æã—ãŸã„éƒ¨åˆ†ã‚’ã‚¿ãƒƒãƒã§é¸æŠã™ã‚‹ã¨ã€ç”»é¢ä¸‹åŠåˆ†ã«è§£æçµæœãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€‚

ãªãŠã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã¾ã¾ã§è§£æã§ãã‚‹ã‚±ãƒ¼ã‚¹ã¯ã»ã¨ã‚“ã©ãªã„ã®ã§ã€å³ä¸Šã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‹ã‚‰èª¿æ•´ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹ã€‚
- ç™½é»’ç”»åƒåŒ–ã¨ã—ãã„å€¤è¨­å®š
- (ä¸Šè¨˜ã®)è¨­å®šã®ãƒªã‚»ãƒƒãƒˆ
- [ztmy-font-tester](https://github.com/tetunori/ztmy-font-tester/)ã¸ã®ç§»å‹•

# ä½¿ç”¨ã™ã‚‹å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
ä¸Šè¨˜æ©Ÿèƒ½ã‚’å®Ÿç¾ã™ã‚‹ã«ã‚ãŸã‚Šã€ä¸‹è¨˜ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ãŸã€‚
- [p5.js](https://github.com/processing/p5.js): `Processing`ã®JavaScriptç‰ˆã€‚æœ¬æ›¸ã§ã¯èª¬æ˜ã¯å‰²æ„›ã™ã‚‹ã®ã§ã€å¿…è¦ãªå ´åˆã¯[æœ¬å®¶ã®Tutorial](https://p5js.org/tutorials/)ã‚’è¦‹ã‚‹ã“ã¨
- [tesseract.js](https://github.com/naptha/tesseract.js): `Tesseract`ã‚’JavaScriptã‹ã‚‰ä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãã‚Œã‚‹ç¥ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€‚å¿…è¦ã«å¿œã˜ã¦[APIä»•æ§˜ã®ãƒšãƒ¼ã‚¸](https://github.com/naptha/tesseract.js/blob/master/docs/api.md)ã‚’è¦‹ã‚‹ã€‚
- [dat.gui](https://github.com/dataarts/dat.gui): GUIã§å¤‰æ•°ã®èª¿æ•´ç­‰ã‚’è¡Œã†ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ãƒã‚¤ãƒ³ãƒˆ

## `Tesseract`ã®ä½¿ã„æ–¹
å‰ã®Chapterã§å¾—ã‚‰ã‚ŒãŸå­¦ç¿’æ¸ˆãƒ‡ãƒ¼ã‚¿`ztmy.traineddata`ã¯`tesseract`ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œã‚Šã€ãã®ä¸­ã¸ã‚³ãƒ”ãƒ¼ã—ã¦ãŠãã€‚
ã¾ãšã¯ã€`p5.js`ã®`preload`é–¢æ•°å†…ã§`Tesseract`ã®workerã‚’æº–å‚™ã™ã‚‹ã€‚
```JavaScript
let tessWorker = undefined;

function preload() {
  // Prepare Tesseract for ZTMY font
  (async () => {
    tessWorker = await Tesseract.createWorker('ztmy', 0, {
      langPath: './tesseract/',
      gzip: false,
    });
  })();
}
```

preloadãŒå®Œäº†ã—ãŸå¾Œã¯ã€èªè­˜ã—ãŸã„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§`tessWorker.recognize`ã‚’å‘¼ã³å‡ºã™ã ã‘ã§ã€èªè­˜çµæœã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

```JavaScript
  const ret = await tessWorker.recognize(image);
  console.log(ret.data.text);  // èªè­˜çµæœã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹
```
[`tessWorker.recognize`](https://github.com/naptha/tesseract.js/blob/master/docs/api.md#worker-recognize)ã¯ã¨ã¦ã‚‚å¼·åŠ›ãªé–¢æ•°ã§ã€å¼•æ•°ã«ã¯`bmp`, `jpg`ãªã©ã®ç”»åƒç³»ã¯ã‚‚ã¡ã‚ã‚“ã®ã“ã¨ã€`File`ã‚„`Blob`ã€`img`ã‚„`canvas`ãªã©[å¹…åºƒã„ã‚½ãƒ¼ã‚¹](https://github.com/naptha/tesseract.js/blob/master/docs/image-format.md)ã‚’æ¸¡ã™ã“ã¨ãŒã§ãã‚‹ã€‚`tesseract.js`ã§ã„ã‹ã«å®¹æ˜“ã«èªè­˜ãŒå¯èƒ½ã‹ç†è§£ã§ããŸã ã‚ã†ã‹ã€‚

## ãƒ•ã‚¡ã‚¤ãƒ«ã®inputã¨drop
æœ€åˆã®ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®ç™»éŒ²æ™‚ã€æœ¬ãƒ„ãƒ¼ãƒ«ã§ã¯ï¼’é€šã‚Šã®æ–¹æ³•ã«å¯¾å¿œã—ã¦ã„ã‚‹ã€‚ï¼‘ã¤ãŒãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ(input)ã€ã‚‚ã†ï¼‘ã¤ãŒãƒ•ã‚¡ã‚¤ãƒ«ã®dropã§ã‚ã‚‹ã€‚`p5.js`ã§ã¯ã€ãã‚Œãã‚Œä»¥ä¸‹ã®æ§˜ã«ç°¡å˜ã«å®Ÿè£…ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã€‚
```JavaScript
function setup() {
  const cvs = createCanvas(windowWidth, windowHeight);
  cvs.drop(handleFile); // canvasã¸dropå‡¦ç†ã®è¿½åŠ 

  // ä¸­ç•¥

  input = createFileInput(handleFile);  // File inputã‚’ä½œæˆ
  input.style('display', 'none');
}

const _mouseClicked = () => {
  input.elt.click();  // ç”»é¢ã‚¿ãƒƒãƒ—ã•ã‚ŒãŸã‚‰ã€Fileé¸æŠç”»é¢é–‹ã
  // ä¸­ç•¥
}
```

ãã®å¾Œã€å®Ÿéš›ã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã‚‹ã¨ã€`handleFile`é–¢æ•°ãŒã‚³ãƒ¼ãƒ«ã•ã‚Œã‚‹ã®ã§ã€æ¸¡ã•ã‚ŒãŸfileã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ãŒç”»åƒã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ãŸã†ãˆã§ã€ä¸Šè¿°ã®èªè­˜é–¢æ•°ã«æ¸¡ã—ã¦ã‚ã’ã‚Œã°OKã€‚ãªãŠã€ã“ã“ã§ã¯`p5.js`ã®`createImg`é–¢æ•°ã§`<img>`ã‚’ä½œã£ã¦ã‹ã‚‰ãã‚Œã‚’æ¸¡ã—ã¦ã„ã‚‹ã€‚

```JavaScript
// Handle file input
const handleFile = (file) => {
  if (file.type === 'image') {
    createImg(file.data, '', '', (img) => {
      // Start 1st time decod
      let recogOptions = {};
      const ret = await tessWorker.recognize(img.elt, recogOptions);
      console.log(ret.data.text);
    });
  }
};
```
ãªãŠã€`tessWorker.recognize`ã®ç¬¬2å¼•æ•°ã«ã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ¸¡ã™ã“ã¨ãŒã§ãã€ä¾‹ãˆã°çŸ©å½¢ã®é ˜åŸŸã‚’æ¸¡ã—ã¦ã‚ã’ã‚‹ã¨ã€ç”»åƒã®ã†ã¡ãã®éƒ¨åˆ†ã ã‘ã®èªè­˜ã‚’ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã‚ã‚‹ã€‚

## ç”»åƒã®ç™½é»’åŒ–
`p5.js`ã«ã¯ã‚‚ã¨ã‚‚ã¨ç”»åƒã‚’filterã§ãã‚‹æ©Ÿèƒ½ãŒã‚ã‚‹ã®ã§ã€ãã‚Œã‚’ä½¿ã£ã¦ç™½é»’2å€¤åŒ–ãŠã‚ˆã³ã—ãã„å€¤ã®æŒ‡å®šã‚’ã—ã¦ã„ã‚‹ã€‚ãã‚Œè‡ªä½“ã¯ç°¡å˜ãªã®ã ãŒã€`canvas`å…¨ä½“ã‚’èªè­˜å¯¾è±¡ã«ã—ã¦ã—ã¾ã†ã¨ç”»åƒä»¥å¤–ã®é ˜åŸŸã‚‚èªè­˜ã—ã‚ˆã†ã¨ã—ã¦ã—ã¾ã†ã®ã§ã€ãƒã‚¤ã‚ºã«ãªã‚Šèªè­˜æ™‚é–“ã‚‚ä¼¸ã³ã¦ã—ã¾ã†ã€‚ã‚ˆã£ã¦ã€`p5.js`ã®`CreateGraphics`é–¢æ•°ã‚’ä½¿ã£ã¦åˆ¥ã®`canvas`ã‚’ã¤ãã‚Šãã‚Œã‚’èªè­˜ã®å¯¾è±¡ã¨ã—ã¦æŒ‡å®šã—ã¦ã„ã‚‹ã€‚

```JavaScript
const decode = () => {
  (async () => {
    const gpx = createGraphics(gImg.width, gImg.height);  // åˆ¥ã®canvasã‚’æº–å‚™
    gpx.image(gImg, 0, 0);  // ç”¨æ„ã—ãŸcanvasã«ç”»åƒã‚’é…ç½®

    if (options.enableFilter) {  // ãƒ•ã‚£ãƒ«ã‚¿ãŒæœ‰åŠ¹ãªã‚‰
      gpx.filter(THRESHOLD, options.threshold);  // ç™½é»’2å€¤ã€ã—ãã„å€¤ã‚’æŒ‡å®šã—ã¦filterã™ã‚‹
      recogTarget = gpx.elt;  // èªè­˜å¯¾è±¡ã¯ã“ã®æ–°ã—ã„canvas element 
    }

    let recogOptions = {};
    const ret = await tessWorker.recognize(recogTarget, recogOptions);
    console.log(ret.data.text);
  })();
};
```


## iPhoneã®Safariã§ã‚¿ãƒƒãƒ—ç³»ã®æ“ä½œãŒåŠ¹ã‹ãªã„
Chromeã§ã¯å¤§ä¸ˆå¤«ãªã®ã ãŒã€Safariã§ã®ã¿ã“ã®ã‚ˆã†ãªå•é¡ŒãŒèµ·ãã‚‹ã“ã¨ãŒã‚ã‚‹ãŒã€`p5.js`ã®`mouseClicked`ãŒãã®ã¾ã¾ã§ã¯å‹•ä½œã—ãªã„ã“ã¨ãŒå•é¡Œã§ã‚ã‚‹ã€‚ã“ã‚Œã«å¯¾ã™ã‚‹work-aroundã¨ã—ã¦`canvas`ã«å¯¾ã—ã¦ã€`.mouseClicked()`ã‚’ç™»éŒ²ã—ã¦ã‚ã’ã‚‹ã ã‘ã§Safari/Chromeä¸¡æ–¹ã§å‹•ä½œã™ã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚ç­†è€…ã¯å…ƒã®`mouseClicked`ã‚’`_mouseClicked`ã«ãƒªãƒãƒ¼ãƒ ã—ã¦è§£æ±ºã—ãŸã€‚
```JavaScript
function setup() {
  const cvs = createCanvas(windowWidth, windowHeight);
  cvs.mouseClicked(_mouseClicked); // For Safari.
  // ä¸­ç•¥
}
```


